-3,4번 코드 작성-[언제든지 수정할 가능성 있음]


#3번 함수
def step3_yolo_analysis(full_frame, model_b):
        """
        YOLO모델을 사용해서, 사람의 상체 위치를 파악, 좌석 점유 현황을 확인하는 부분
        """
        results = model_b.predict(full_frame, verbose=False)
        seat_status = {name: "Empty" for name in config.SEAT_COORDNATES}
        for result in results:
            for box in result.boxes:
                if box.cls == 0: #사람의 유무 판별하는 부분
                    x1,y1,x2,y2 = box.xyxy[0].cpu().numpy()

                    #기준점 추출 (상체 기준? 하체기준? 한다면  몇% 지점?, 20? 30?, 우선 25%로 잡고 시작하지만 변경 될 수도 있음)
                    body_x = int((x1 + x2) / 2)
                    body_y = int(y1 - (y2-y1) * 0.25)
                    #상체 좌표가 설정된 좌석 내에 누가 있는지 확인
                    for seat_name, (sx,sy,sw,sh) in config.SEAT_COORDNATES.items():
                        if sx < body_x < sx + sw and sy < body_y < sy + sh:
                            seat_status[seat_name] = "Seat" # 두 조건이 참 일경우,좌석 사용중
        return seat_status
#4번 함수
def step4_logic_dicision(seat_status):
    """
    입구 기준으로 선착순으로 빈 자리를 찾아서 배정해주는 과정
    """
    empty_seats = [name for name, status in seat_status.items() if status == "Empty"] #현재 비어있는 좌석 목록 추출
    #모든 자리가 찬 경우 경고 표시
    if not empty_seats:
        return "빈 좌석이 없습니다!!!"

    #기준점 설정, 아마도 사진 기준 오른쪽 아래 좌표를 기준점(입구)로 할 거 같음
    config.ENTRANCE_CODE = (x,y) #config 에서 지정한 입구 좌표
    entrance_x, entrance_y = config.ENTRANCE_CODE
    best_seat = None
    min_distance = float('inf')

    #지정한 입구에서 각각의 빈자리까지의 거리 계산
    for seat in empty_seats:
        sx,sy,sw,sh = config.SEAT_COORDNATES[seat]
        seat_center_x = sx + sw/2
        seat_center_y = sy + sh/2
        #가장 가까운 거리 계산(입구 기준 좌석 계산)
        distance  = math.sqrt((entrance_x-seat_center_x)**2 + (entrance_y-seat_center_y)**2)
        #가장 가까운 거리 업데이트
        if distance < min_distance:
            min_distance = distance
            best_seat = seat
    return best_seat #best_seat = 최단 거리(추천 거리)
