#main 블록
#Qt에서 만든 UI파일을 연결
# from_class = uic.loadUiType("parking.ui")[0] #"" = 만든 .ui 파일 이름부분
def main():
    #초기화 부분
    pytesseract_engine, model_b = step0_initialize()
    if pytesseract_engine is None or model_b is None:
        print("초기화 실패!!! 시스템 종료!!!")
        return

    #웹캠 켜기, 비디오 입력
    cap = cv2.VideoCapture(0)
    if not cap.isOpened():
        print("카메라를 열 수 없음")
        return
    print("시스템 시작")

    while True:
        ret, frame = cap.read()
        if not ret:
            break


        #번호판 ROI 추출
        roi_frame = frame #TODO: 번호판 detection
        vehicle_no = step1_ocr_process(roi_frame)
        if not vehicle_no:
            cv2.imshow("Main", frame)
            if cv2.waitKey(1) & 0xFF == 27:
                break
            continue
        print("인식 번호:", vehicle_no)
#만들어온 model, db를 불러옴
        user_data = step2_db_check(vehicle_no)

        seat_status = step3_yolo_analysis(frame,model_b)

        bridge_result = bridge_user_to_system(user_data, seat_status)

        if not bridge_result["ok"]:
            print(bridge_result["message"])
            cv2.imshow("Main", frame)
            if cv2.waitKey(1) & 0xFF == 27:
                break
            continue

        final_seat = step4_logic_dicision(seat_status)

        frame, guide_msg = step5_visual_guide(frame, final_seat)
        
        cv2.imshow("Main", frame)
        if cv2.waitKey(1) & 0xFF == 27:
            break
    cap.release()
    cv2.destroyAllWindows()
